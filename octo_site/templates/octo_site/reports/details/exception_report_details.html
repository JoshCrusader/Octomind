{% include 'octo_site/includes/header_reports.html' %}
<!-- CONTENT -->
{% load staticfiles %}
	<script src="{% static 'octo_site/res/Chart.js/Chart.bundle.js' %}"></script>
	<script src="{% static 'octo_site/res/Chart.js/samples/utils.js' %}"></script>

        <link rel="stylesheet" href = "{% static 'styles/view_room.css' %}" type = "text/css">

	<style>
	canvas{
		-moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}
    .myProgress {
      width: 80px;
    }
    .myBar {
      width: 100%;
      height: 15px;
      background-color: cornflowerblue;
    }
	</style>
<div id="content" style="padding: 0 0 0 0; margin-left: 0px;" uk-height-viewport>
    <section class="uk-section uk-article" style="background-color: #f7f7f7;padding: 0px" >
        {% if report_data.has_result %}

        <div class="uk-container-expand" id="chart_container" style="margin-left: 0px; display:block;height: 70vh;">
            <div uk-grid>
                <div class="uk-width-expand@m uk-align-center" >
                    <ul id="component-tab-right" STYLE="margin-left:10vw;"  class="uk-switcher">
                        <li style="height: 70vh">
                            <div class="chart-container" style="height:20vh;width:85%" >
                                <canvas class="uk-align-center" id="log_dist" ></canvas>
                            </div>
                        </li>
                        <li style="height: 70vh">
                            <div class="chart-container" style="height:20vh;width:85%" >
                                <canvas class="uk-align-center" id="log_sum" ></canvas>
                            </div>
                        </li>
                        <li style="height: 70vh">
                            <div class="chart-container" style="height:20vh;width:85%" >
                                <!-- <canvas class="uk-align-center" id="log_sum" ></canvas> -->
                                <div id="player_div" style="width: 100%; height: 551px;">
                                    <div style = "width: 60%; height: 100%; float: left;">
                                        <div style = "width: 100%; height: 20%;" >
                                        Total Players: chuchu
                                        </div>
                                        <div style = "width: 100%; height: 80%; position: relative;" >
                                            <canvas id = "age_bar_chart"></canvas>
                                        </div>
                                    </div>
                                    <div style = "width: 40%; height: 50%; float: left;">
                                        <canvas id = "gender_pie_chart"></canvas>
                                    </div>
                                    <div style = "width: 40%; height: 50%; float: left;">
                                        <canvas id = "team_size_pie_chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li style="height: 70vh">
                            <div class="chart-container" style="height:20vh;width:85%" >
                                <!-- <canvas class="uk-align-center" id="log_sum" ></canvas> -->
                                <div class = "area-count" style = "position: absolute;width: 200px; height: 350px; margin-top: 150px; overflow-x: auto; overflow-y: auto;z-index: 999!important;">
                                    <div style = 'color: orange; font-size: 15px; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;font-weight: bold;'>Player distribution per area:</div>
                                    <div id = "area-legend">
                                    </div>
                                </div>
                                <div id="mapdiv" style="width: 100%; height: 551px;"></div>

                            </div>
                        </li>
                        <li style="height: 70vh">
                        </li>
                    </ul>

                    <div class="uk-width-1-1 uk-text-right uk-align-right" >
                        <ul style="margin-left: -19px;" uk-tab="connect: #component-tab-right; animation:  uk-animation-slide-left-medium, uk-animation-slide-right-medium" >
                            <li><a href="#" onclick="$('#s_plot').hide()"><span data-uk-icon="icon: grid"></span> Sensor Log Distribution</a></li>
                            <li><a href="#" onclick="$('#s_plot').hide()"><span data-uk-icon="icon: thumbnails"></span> Joint Summary</a></li>
                            <li><a href="#" onclick="$('#s_plot').hide()"><span data-uk-icon="icon: users"></span> Player Summary</a></li>
                            <li><a href="#" onclick="$('#s_plot').hide()"><span data-uk-icon="icon: world"></span> Market Demographics</a></li>
                            <li><a href="#" onclick="$('#s_plot').show()"><span data-uk-icon="icon: rss"></span> Sensor Mapping</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="uk-width-1-1" style="padding-right: 2vw;padding-left: 2vw;padding-top: 1vh;padding-bottom: 2vh;background-color: white ">
            <div class="uk-grid" >
                <div class="uk-width-auto uk-text-left" >
                    <h4 class="uk-margin-remove-bottom uk-text-left"> <b>{{ room.room_name }}</b> <span  class="uk-text-primary" data-uk-icon="icon: gitter;ratio: 1.0;"></span></h4>
                    <p class="uk-margin-remove uk-text-small">Report {{ msg }} <b class="uk-text-muted">({{ records_len }} Records Found)</b></p>
                </div>

                <div class="uk-width-expand uk-text-right">
                    <label uk-tooltip="Show all time statistics vs metrics"><input class="uk-checkbox" type="checkbox" onclick="show_stats(this)"> All-time Stats</label> |
                    <label uk-tooltip="Show Reports with a summary chart"><input class="uk-checkbox" type="checkbox" onclick="show_chart(this)"> Chart</label> |
                    <label uk-tooltip="Show summary insights"><input class="uk-checkbox" type="checkbox"  onclick="show_summary(this)" checked> Summary</label> |
                    <a href="#" uk-tooltip="Print Report" onclick="window.print()" ><i class="fa fa-print" style="font-size: 22px"></i></a>
                </div>
            </div>
        </div>
        <div class="uk-width-1-1" style="background-color:#FFF; ">
            <div class="uk-card uk-card-default uk-card-small uk-card-hover" style="background-color: #fff;padding-left: 3vw;padding-right: 2vw">
            <div class="uk-card-header">
                <div class="uk-grid uk-grid-medium" >
                        <div class="uk-width-auto" >
                            <h4 class="uk-margin-remove-bottom uk-text-primary"><span class="uk-text-primary" data-uk-icon="icon: list;ratio: 1"></span> List of Games Included </h4>
                        </div>
                        <div class="uk-width-expand uk-text-right">
                            <button class="uk-button uk-button-default uk-button-small " disabled> Discard <span data-uk-icon="icon: trash"></span></button>
                        </div>
                        <div class="uk-card-body uk-align-center uk-width-1-1">
                            <div class="uk-overflow-auto">
                                     <table id="room_tbl" class="uk-table uk-table-hover uk-table-divider" style="width:100%">
                                          <thead>
                                              <tr>
                                                  <th class="uk-table-shrink uk-text-nowrap"></th>
                                                  <th class="uk-width-small">Match ID</th>
                                                  <th class="uk-width-medium">Time Start & End</th>
                                                  <th class="uk-width-medium">Team name</th>
                                                  <th class="uk-width-medium">Duration</th>
                                                  <th class="uk-width-medium">Anomaly Detection</th>
                                              </tr>
                                          </thead>
                                          <tbody>
                                          {% load static %}
                                          {% for game in games %}
                                                <tr class="tbl_toggle">
                                                    <td class="uk-text-center"><input class="uk-checkbox" value="gago" name="room_to_analyze[]" type="checkbox"></td>
                                                    <td>
                                                        <a class="uk-text-emphasis"><b>{{ game.match_id }}</b></a>
                                                        {% if game.is_solved %}
                                                            <p class="uk-text-small" style="margin-top: 0px">Mystery Solved</p>
                                                        {% else %}
                                                            <p class="uk-text-small" style="margin-top: 0px">Mystery Unsolved</p>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <p class="uk-text-emphasis uk-margin-remove"><b>{{ game.game_details.timestart.time |  time:"g:i:s A" }}</b>
                                                            {% if game.is_solved %}
                                                                to
                                                                <b>{{ game.game_details.timeend.time |  time:"g:i:s A" }}</b> </p>
                                                            {% endif %}
                                                        <p class="uk-text-small" style="margin-top: 0px">{{ game.game_details.timestart.date | date:"M d, Y" }}</p>
                                                    </td>
                                                    <td>
                                                        <p class="uk-text-emphasis uk-margin-remove"><b>{{ game.game_details.teamname }}</b></p>
                                                        <p class="uk-text-small uk-margin-remove">{{ game.get_num_clues_asked }} clues asked</p>
                                                    </td>
                                                    <td>
                                                        <p class="uk-text-emphasis uk-margin-remove"><b style="color: orange">{{ game.get_duration }}</b> minutes</p>
                                                        <div class="myProgress">
                                                          <div class="myBar" style="width: {{ game.get_duration }}px"></div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        {% if game.has_error %}
                                                            <h5 class="uk-heading-bullet uk-margin-remove uk-text-danger"><span class="uk-text-danger" data-uk-icon="icon: warning"></span> Sequence anomaly detected</h5>
                                                        {% endif %}
                                                        {% if game.has_warning %}
                                                            <h5 class="uk-heading-bullet uk-margin-remove uk-text-warning"><span class="uk-text-warning" data-uk-icon="icon: warning"></span> Sensor anomaly detected</h5>
                                                        {% endif %}
                                                        {% if game.has_error == False and game.has_warning == False %}
                                                            <h5 class="uk-heading-bullet uk-margin-remove uk-text-success"><span class="" data-uk-icon="icon: check"></span> No anomaly detected</h5>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                          {% endfor %}
                                          </tbody>
                                     </table>
                                    <script>
                                        $(document).ready(function() {
                                        $('#room_tbl').DataTable();
                                        });
                                    </script>
                                    </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
            <div class="uk-width-1-1 uk-text-center uk-position-center">
                <h1><i class="fa fa-frown-o uk-text-muted fa-3x"></i></h1>
                <h1 class="uk-text-muted">No Results found.</h1>

                <h1 class="uk-text-muted"><a href="{% url 'room_analysis' %}">Create another report.</a></h1>
            </div>
        {% endif %}
    </section>
</div>

<script>
    var color = Chart.helpers.color;
    let chartColors = {
      red: 'rgb(255, 65, 54)',
      yellow: 'rgb(239, 206, 0)',
      green: 'rgb(61, 142, 106)',
      blue: 'rgb(28, 143, 219)',
      orange: 'rgb(255, 118, 0)',
      purple: 'rgb(153, 102, 255)',
      grey: 'rgb(231,233,237)',
      black: 'rgb(0,0,0)',
    };

    var colorNames = Object.keys(chartColors);

    window.onload = function() {};
</script>
<script>
    $.post( "test.php", { name: "John", time: "2pm" })
    .done(function( data ) {
        alert( "Data Loaded: " + data );
    });
</script>
{% include 'octo_site/includes/offcanvas_reports.html' %}
